"use strict";(self.webpackChunkcloudcontrol=self.webpackChunkcloudcontrol||[]).push([[965],{965:function(n,e,a){var i=a(130),o=(a(472),a(720)),t=a(26);class s{constructor(n,e,a,i){this.db=n,this.storage=e,this.auth=a,this.tenantId=i}init(n,e,a,i){this.db=n,this.storage=e,this.auth=a,this.tenantId=i,console.log(`✅ DatabaseService inicializado para tenant: ${i}`)}static createForTenant(n,e,a,i){return new s(n,e,a,i)}collection(n){if(!this.db)throw new Error("Serviço de banco de dados não inicializado");return(0,t.rJ)(this.db,"tenants",this.tenantId,n)}async getDocument(n,e){if(!this.db)throw new Error("Serviço de banco de dados não inicializado");try{const a=(0,t.H9)(this.db,"tenants",this.tenantId,n,e),i=await(0,t.x7)(a);return i.exists()?{id:i.id,...i.data()}:null}catch(a){throw console.error(`❌ Erro ao obter documento ${e} da coleção ${n}:`,a),a}}async getDocuments(n,e={}){if(!this.db)throw new Error("Serviço de banco de dados não inicializado");try{let a=(0,t.rJ)(this.db,"tenants",this.tenantId,n);if(e.where&&Array.isArray(e.where)&&e.where.forEach((n=>{3===n.length&&(a=(0,t.P)(a,(0,t._M)(n[0],n[1],n[2])))})),e.orderBy){const n="desc"===e.orderDirection?"desc":"asc";a=(0,t.P)(a,(0,t.My)(e.orderBy,n))}return e.limit&&"number"==typeof e.limit&&(a=(0,t.P)(a,(0,t.AB)(e.limit))),(await(0,t.GG)(a)).docs.map((n=>({id:n.id,...n.data()})))}catch(e){throw console.error(`❌ Erro ao obter documentos da coleção ${n}:`,e),e}}async addDocument(n,e){if(!this.db)throw new Error("Serviço de banco de dados não inicializado");try{const a=(0,t.H9)((0,t.rJ)(this.db,"tenants",this.tenantId,n));return await(0,t.BN)(a,{...e,createdAt:new Date,updatedAt:new Date,createdBy:this.auth?.currentUser?.uid||null}),{id:a.id,...e}}catch(e){throw console.error(`❌ Erro ao adicionar documento à coleção ${n}:`,e),(0,o.Ds)("Erro ao salvar dados. Tente novamente.","error"),e}}async updateDocument(n,e,a){if(!this.db)throw new Error("Serviço de banco de dados não inicializado");try{const i=(0,t.H9)(this.db,"tenants",this.tenantId,n,e);await(0,t.mZ)(i,{...a,updatedAt:new Date,updatedBy:this.auth?.currentUser?.uid||null});const o=await(0,t.x7)(i);return{id:o.id,...o.data()}}catch(a){throw console.error(`❌ Erro ao atualizar documento ${e} da coleção ${n}:`,a),(0,o.Ds)("Erro ao atualizar dados. Tente novamente.","error"),a}}async deleteDocument(n,e){if(!this.db)throw new Error("Serviço de banco de dados não inicializado");try{const a=(0,t.H9)(this.db,"tenants",this.tenantId,n,e);await(0,t.kd)(a)}catch(a){throw console.error(`❌ Erro ao excluir documento ${e} da coleção ${n}:`,a),(0,o.Ds)("Erro ao excluir dados. Tente novamente.","error"),a}}async runTransaction(n){if(!this.db)throw new Error("Serviço de banco de dados não inicializado");try{return await this.db.runTransaction(n)}catch(n){throw console.error("❌ Erro na transação:",n),(0,o.Ds)("Erro na operação. Tente novamente.","error"),n}}async runBatch(n){if(!this.db)throw new Error("Serviço de banco de dados não inicializado");try{const e=this.db.batch();await n(e),await e.commit()}catch(n){throw console.error("❌ Erro no lote:",n),(0,o.Ds)("Erro na operação em lote. Tente novamente.","error"),n}}async uploadFile(n,e,a={}){if(!this.storage)throw new Error("Serviço de storage não inicializado");try{const i=this.storage.ref().child(e),o={...a,customMetadata:{...a.customMetadata,uploadedBy:this.auth?.currentUser?.uid||"anonymous",uploadedAt:(new Date).toISOString()}},t=await i.put(n,o);return await t.ref.getDownloadURL()}catch(n){throw console.error("❌ Erro ao fazer upload de arquivo:",n),(0,o.Ds)("Erro ao enviar arquivo. Tente novamente.","error"),n}}async deleteFile(n){if(!this.storage)throw new Error("Serviço de storage não inicializado");try{const e=this.storage.ref().child(n);await e.delete()}catch(n){throw console.error("❌ Erro ao excluir arquivo:",n),(0,o.Ds)("Erro ao excluir arquivo. Tente novamente.","error"),n}}onDocumentChange(n,e,a){if(!this.db)throw new Error("Serviço de banco de dados não inicializado");const i=(0,t.H9)(this.db,"tenants",this.tenantId,n,e);return(0,t.aQ)(i,(n=>{n.exists()?a({id:n.id,...n.data()}):a(null)}),(n=>{console.error(`❌ Erro ao observar documento ${e}:`,n)}))}onCollectionChange(n,e={},a){if(!this.db)throw new Error("Serviço de banco de dados não inicializado");let i=(0,t.rJ)(this.db,"tenants",this.tenantId,n);if(e.where&&Array.isArray(e.where)&&e.where.forEach((n=>{3===n.length&&(i=(0,t.P)(i,(0,t._M)(n[0],n[1],n[2])))})),e.orderBy){const n="desc"===e.orderDirection?"desc":"asc";i=(0,t.P)(i,(0,t.My)(e.orderBy,n))}return e.limit&&"number"==typeof e.limit&&(i=(0,t.P)(i,(0,t.AB)(e.limit))),(0,t.aQ)(i,(n=>{const e=n.docs.map((n=>({id:n.id,...n.data()})));a(e)}),(e=>{console.error(`❌ Erro ao observar coleção ${n}:`,e)}))}}const d={currentUser:null,currentSection:null,products:[],sales:[],customers:[],isLoading:!1},r={"Dono/Gerente":[{id:"geral",icon:"fa-chart-pie",text:"Painel Geral"},{id:"produtos",icon:"fa-boxes-stacked",text:"Produtos"},{id:"vendas",icon:"fa-file-invoice-dollar",text:"Vendas"},{id:"clientes",icon:"fa-users",text:"Clientes"},{id:"relatorios",icon:"fa-chart-bar",text:"Relatórios"}],"Controlador de Estoque":[{id:"estoque",icon:"fa-warehouse",text:"Painel Estoque"},{id:"produtos",icon:"fa-boxes-stacked",text:"Produtos"},{id:"movimentacoes",icon:"fa-exchange-alt",text:"Movimentações"}],Vendedor:[{id:"vendas-painel",icon:"fa-dollar-sign",text:"Painel Vendas"},{id:"nova-venda",icon:"fa-cash-register",text:"Nova Venda"},{id:"minhas-vendas",icon:"fa-history",text:"Minhas Vendas"},{id:"produtos-consulta",icon:"fa-search",text:"Consultar Produtos"}]};async function c(n){const e=document.getElementById("dynamicContentArea");if(e){console.log("[Dashboard] Iniciando loadSection:",n),e.innerHTML=`\n        <div class="loading-container">\n            <div class="loading-spinner"></div>\n            <p>Carregando ${n}...</p>\n        </div>\n    `;try{switch(d.currentSection=n,document.querySelectorAll(".nav-link").forEach((e=>{e.classList.toggle("active",e.dataset.section===n)})),n){case"geral":case"vendas-painel":case"estoque":console.log("[Dashboard] Importando dashboard-kpis.js para:",n);try{const{loadKPIs:e}=await a.e(837).then(a.bind(a,837));await async function(n,e){document.getElementById("dynamicContentArea").innerHTML=`\n        <div class="dashboard-container">\n            <div class="dashboard-header">\n                <h2>${function(n){const e=Object.values(r).flat().find((e=>e.id===n));return e?e.text:"Dashboard"}(n)}</h2>\n                <p>Visão geral do sistema</p>\n            </div>\n            <div class="kpi-grid" id="kpiGrid">\n                \x3c!-- KPIs serão inseridos aqui --\x3e\n            </div>\n            <div class="dashboard-content mt-6">\n                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">\n                    <div class="card">\n                        <div class="card-header">\n                            <h3>Atividade Recente</h3>\n                        </div>\n                        <div class="card-body">\n                            <p class="text-muted">Dados de atividade serão exibidos aqui</p>\n                        </div>\n                    </div>\n                    <div class="card">\n                        <div class="card-header">\n                            <h3>Estatísticas</h3>\n                        </div>\n                        <div class="card-body">\n                            <p class="text-muted">Gráficos e estatísticas serão exibidos aqui</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `,await e(n)}(n,(n=>e(n,window.databaseService)))}catch(n){console.error("[Dashboard] Erro ao importar ou executar dashboard-kpis.js:",n),e.innerHTML=`<div style='color:#ef4444;text-align:center;padding:2rem'><h2>Erro ao carregar KPIs.</h2><p>${n.message}</p></div>`}break;case"produtos":case"produtos-consulta":{const{loadProductsSection:n}=await a.e(94).then(a.bind(a,94));await n(d,window.databaseService);break}case"vendas":case"minhas-vendas":{const{loadSalesSection:e}=await a.e(876).then(a.bind(a,495));await e(d,n,window.databaseService);break}case"nova-venda":await async function(){document.getElementById("dynamicContentArea").innerHTML='\n        <div class="new-sale-container">\n            <div class="section-header">\n                <h2>Nova Venda</h2>\n            </div>\n            <div class="sale-form mt-6">\n                <p class="text-muted">Formulário de venda será exibido aqui</p>\n            </div>\n        </div>\n    '}();break;case"clientes":{const{loadCustomersSection:n}=await a.e(145).then(a.bind(a,145));await n(d,window.databaseService);break}case"relatorios":{const{loadReportsSection:n}=await a.e(583).then(a.bind(a,583));await n(d);break}case"movimentacoes":{const{loadMovementsSection:n}=await a.e(594).then(a.bind(a,594));await n(d);break}default:e.innerHTML='\n                    <div class="empty-state">\n                        <i class="fas fa-hard-hat fa-3x"></i>\n                        <h3>Seção em Desenvolvimento</h3>\n                        <p>Esta funcionalidade estará disponível em breve.</p>\n                    </div>\n                '}console.log("[Dashboard] loadSection concluído:",n)}catch(n){console.error("[Dashboard] Erro ao carregar seção:",n),e.innerHTML=`\n            <div class="error-state">\n                <i class="fas fa-exclamation-triangle fa-3x"></i>\n                <h3>Erro ao Carregar</h3>\n                <p>${n.message}</p>\n                <button onclick="location.reload()" class="btn-primary mt-4">\n                    <i class="fas fa-redo mr-2"></i> Recarregar\n                </button>\n            </div>\n        `}}}function l(n,e="info"){const a=document.getElementById("temporaryAlertsContainer");if(!a)return;const i=document.createElement("div");i.className=`notification notification-${e}`,i.innerHTML=`\n        <div class="notification-content">\n            <i class="fas ${function(n){const e={success:"fa-check-circle",error:"fa-times-circle",warning:"fa-exclamation-triangle",info:"fa-info-circle"};return e[n]||e.info}(e)}"></i>\n            <span>${n}</span>\n        </div>\n        <button class="notification-close" onclick="this.parentElement.remove()">\n            <i class="fas fa-times"></i>\n        </button>\n    `,a.appendChild(i),setTimeout((()=>{i.remove()}),5e3)}document.addEventListener("DOMContentLoaded",(async function(){console.log("🚀 Inicializando CloudControl Dashboard v2.0...");let n=!1;setTimeout((()=>{if(!n){const n=document.getElementById("dynamicContentArea");n&&(n.innerHTML='<div style="color:#ef4444;text-align:center;padding:2rem"><h2>Não foi possível carregar o dashboard.</h2><p>Verifique sua conexão ou tente recarregar a página.</p></div>')}}),5e3);try{const e=window.tenantConfig?.firebaseConfig,a=window.tenantConfig?.companyName||"default",o=i.u.createForTenant(e,a),t=s.createForTenant(o.db,o.storage,o.auth,a);o.onAuthStateChanged((n=>async function(n,e){if(n)try{const a=await e.collection("users").doc(n.uid).get();if(!a.exists)throw new Error("Dados do usuário não encontrados");{d.currentUser={uid:n.uid,email:n.email,...a.data()},function(n){const e=n.name?n.name.split(" ").map((n=>n[0])).join("").substring(0,2).toUpperCase():n.email.substring(0,2).toUpperCase();document.getElementById("userInitials").textContent=e,document.getElementById("usernameDisplay").textContent=n.name||n.email.split("@")[0],document.getElementById("userRoleDisplay").textContent=n.role||"Usuário",function(n){const e=document.getElementById("navLinks");if(!e)return;const a=r[n]||[];e.innerHTML=a.map((n=>`\n        <a href="#${n.id}" class="nav-link" data-section="${n.id}">\n            <i class="fas ${n.icon} nav-link-icon"></i>\n            <span>${n.text}</span>\n        </a>\n    `)).join("")}(n.role)}(d.currentUser);const e=window.location.hash.substring(1),i=r[d.currentUser.role]?.[0]?.id||"geral";c(e||i)}}catch(n){console.error("Erro ao carregar dados do usuário:",n),l("Erro ao carregar perfil","error")}else window.location.href="../index.html"}(n,t))),document.body.classList.add("loading"),setTimeout((()=>{const n=document.getElementById("loadingScreen");n&&n.classList.add("hidden"),document.body.classList.remove("loading")}),1e3),window.addEventListener("hashchange",(()=>{const n=window.location.hash.substring(1);n&&d.currentUser&&c(n)})),function(){const n=document.getElementById("logoutButton");n&&n.addEventListener("click",(async()=>{try{await firebase.auth().signOut(),window.location.href="../index.html"}catch(n){console.error("Erro ao fazer logout:",n),l("Erro ao sair","error")}}));const e=document.getElementById("mobileMenuToggle"),a=document.getElementById("sidebar"),i=document.getElementById("sidebarOverlay");e&&a&&e.addEventListener("click",(()=>{a.classList.toggle("mobile-open"),i&&i.classList.toggle("active")})),i&&i.addEventListener("click",(()=>{a.classList.remove("mobile-open"),i.classList.remove("active")})),document.querySelectorAll("[data-dropdown]").forEach((n=>{n.addEventListener("click",(e=>{e.stopPropagation();const a=n.dataset.dropdown,i=document.getElementById(a);i&&i.classList.toggle("hidden")}))})),document.addEventListener("click",(()=>{document.querySelectorAll(".dropdown").forEach((n=>{n.classList.add("hidden")}))}))}(),window.databaseService=t,n=!0,c("geral"),console.log("✅ Dashboard inicializado com sucesso")}catch(n){console.error("❌ Erro na inicialização:",n);const e=document.getElementById("dynamicContentArea");e&&(e.innerHTML=`<div style="color:#ef4444;text-align:center;padding:2rem"><h2>Erro ao inicializar o dashboard.</h2><p>${n.message||"Erro desconhecido."}</p></div>`)}})),window.openProductModal=function(){l("Modal de produto será implementado","info")},window.openCustomerModal=function(){l("Modal de cliente será implementado","info")},window.AppState=d,window.loadSection=c,window.showNotification=l,function(){const n=document.getElementById("app");n&&(n.innerHTML='\n    <div id="loadingScreen" class="loading-screen">\n        <div class="loading-content">\n            <div class="loading-logo">\n                <i class="fas fa-chart-line"></i>\n            </div>\n            <div class="loading-text">\n                <h2>EliteControl</h2>\n                <p>Carregando sistema...</p>\n            </div>\n            <div class="loading-spinner">\n                <div class="spinner"></div>\n            </div>\n        </div>\n    </div>\n    <header class="header">\n        <div class="header-content">\n            <button id="mobileMenuToggle" class="mobile-menu-toggle md:hidden">\n                <i class="fas fa-bars"></i>\n            </button>\n            <div class="header-logo">\n                <div class="header-logo-icon">\n                    <i class="fas fa-chart-line"></i>\n                </div>\n                <span class="header-logo-text">EliteControl</span>\n                <span class="header-version">v2.0</span>\n            </div>\n            <div class="header-actions">\n                <div class="header-search hidden md:block">\n                    <div class="search-container">\n                        <input type="text" id="globalSearch" class="search-input" placeholder="Buscar...">\n                        <i class="fas fa-search search-icon"></i>\n                    </div>\n                </div>\n                <div class="quick-actions hidden md:flex">\n                    <button id="quickSaleButton" class="quick-action-btn" title="Nova Venda">\n                        <i class="fas fa-plus"></i>\n                    </button>\n                    <button id="quickProductButton" class="quick-action-btn" title="Novo Produto">\n                        <i class="fas fa-box"></i>\n                    </button>\n                </div>\n                <div class="relative">\n                    <button id="notificationBellButton" class="notification-button">\n                        <i class="fas fa-bell"></i>\n                        <span id="notificationCountBadge" class="notification-badge hidden">0</span>\n                    </button>\n                    <div id="notificationDropdown" class="notification-dropdown hidden">\n                        <div class="notification-header">\n                            <span class="notification-title">Notificações</span>\n                            <button id="markAllAsReadButton" class="notification-action">Marcar todas como lidas</button>\n                        </div>\n                        <div id="notificationList" class="notification-list scrollbar-thin"></div>\n                    </div>\n                </div>\n                <div class="user-menu">\n                    <button id="userMenuButton" class="user-button">\n                        <div id="userAvatar" class="user-avatar">\n                            <span id="userInitials">U</span>\n                        </div>\n                        <div class="user-info hidden lg:block">\n                            <div id="usernameDisplay" class="user-name">Usuário</div>\n                            <div id="userRoleDisplay" class="user-role">Cargo</div>\n                        </div>\n                        <i class="fas fa-chevron-down user-chevron hidden lg:block"></i>\n                    </button>\n                    <div id="userDropdown" class="user-dropdown hidden">\n                        <div class="user-dropdown-header">\n                            <div class="user-dropdown-avatar">\n                                <span id="userDropdownInitials">U</span>\n                            </div>\n                            <div id="userDropdownName" class="user-dropdown-name">Usuário</div>\n                            <div id="userDropdownEmail" class="user-dropdown-email">usuario@exemplo.com</div>\n                        </div>\n                        <ul class="user-dropdown-menu">\n                            <li class="user-dropdown-item" onclick="showUserProfile()">\n                                <i class="fas fa-user user-dropdown-item-icon"></i>\n                                <span>Meu Perfil</span>\n                            </li>\n                            <li class="user-dropdown-item" onclick="showSettings()">\n                                <i class="fas fa-cog user-dropdown-item-icon"></i>\n                                <span>Configurações</span>\n                            </li>\n                            <li class="user-dropdown-item" onclick="showHelp()">\n                                <i class="fas fa-question-circle user-dropdown-item-icon"></i>\n                                <span>Ajuda</span>\n                            </li>\n                            <div class="user-dropdown-divider"></div>\n                            <li id="logoutButton" class="user-dropdown-item user-dropdown-item-logout">\n                                <i class="fas fa-sign-out-alt user-dropdown-item-icon"></i>\n                                <span>Sair</span>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </header>\n    <aside id="sidebar" class="sidebar scrollbar-thin">\n        <div id="sidebarOverlay" class="sidebar-overlay md:hidden"></div>\n        <div class="sidebar-content">\n            <div class="sidebar-header">\n                <div id="sidebarProfileName" class="sidebar-title">Painel</div>\n                <button id="sidebarCloseButton" class="sidebar-close md:hidden">\n                    <i class="fas fa-times"></i>\n                </button>\n            </div>\n            <nav id="navLinks" class="nav-section"></nav>\n            <div class="sidebar-stats">\n                <div class="stat-item">\n                    <div class="stat-icon">\n                        <i class="fas fa-clock"></i>\n                    </div>\n                    <div class="stat-content">\n                        <div class="stat-label">Online</div>\n                        <div id="onlineTime" class="stat-value">--:--</div>\n                    </div>\n                </div>\n            </div>\n            <div class="sidebar-footer">\n                <div class="sidebar-version">\n                    <i class="fas fa-code-branch"></i>\n                    EliteControl v2.0\n                </div>\n            </div>\n        </div>\n    </aside>\n    <main id="mainContent" class="main-content">\n        <div class="page-header">\n            <div class="page-header-content">\n                <div class="page-header-left">\n                    <h1 id="pageTitle" class="page-title">Painel</h1>\n                    <p id="pageSubtitle" class="page-subtitle">Sua visão personalizada do sistema.</p>\n                </div>\n                <div class="page-header-right">\n                    <div class="page-header-time">\n                        <i class="fas fa-calendar-alt"></i>\n                        <span id="currentDate">--</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div id="dynamicContentArea" class="dynamic-content">\n            <div class="content-loading">\n                <div class="loading-spinner-container">\n                    <div class="loading-spinner-large">\n                        <div class="spinner-large"></div>\n                    </div>\n                    <p>Carregando dashboard...</p>\n                </div>\n            </div>\n        </div>\n    </main>\n    <div id="temporaryAlertsContainer" class="temporary-alerts-container"></div>\n    <div id="productModal" class="modal-backdrop hidden">\n        <div class="modal-content modal-lg">\n            \x3c!-- ...modal de produto... --\x3e\n        </div>\n    </div>\n    <div id="universalModal" class="modal-backdrop hidden">\n        <div id="universalModalContent" class="modal-content"></div>\n    </div>\n    <div id="modalPlaceholder"></div>\n    <div id="fabContainer" class="fab-container">\n        <button id="mainFab" class="fab-main">\n            <i class="fas fa-plus"></i>\n        </button>\n        <div id="fabMenu" class="fab-menu hidden">\n            <button class="fab-item" data-action="new-sale" title="Nova Venda">\n                <i class="fas fa-cash-register"></i>\n            </button>\n            <button class="fab-item" data-action="new-product" title="Novo Produto">\n                <i class="fas fa-box"></i>\n            </button>\n            <button class="fab-item" data-action="new-customer" title="Novo Cliente">\n                <i class="fas fa-user-plus"></i>\n            </button>\n        </div>\n    </div>\n    ')}()}}]);