"use strict";(self.webpackChunkcloudcontrol=self.webpackChunkcloudcontrol||[]).push([[130],{130:function(e,t,a){a.d(t,{u:function(){return s}});var n=a(472),r=a(720),o=a(927),i=a(26);class s{constructor(e,t){this.tenantId=t,this.config=e,this.app=null,this.auth=null,this.db=null,this.storage=null,this.currentUser=null,this.authStateChangedCallbacks=[]}init(){try{this.app=(0,n.rf)(this.config,this.tenantId),this.auth=(0,n.ap)(this.app),this.db=(0,n.xL)(this.app),this.storage=(0,n.fW)(this.app),this.auth.onAuthStateChanged(this.handleAuthStateChanged.bind(this)),console.log(`✅ AuthService inicializado para tenant: ${this.tenantId}`)}catch(e){console.error("❌ Erro ao inicializar serviço de autenticação:",e),(0,r.Ds)("Erro ao inicializar serviço de autenticação. Tente novamente mais tarde.","error")}}async handleAuthStateChanged(e){const t=window.location.hash.replace("#","");if(e)try{const a=await(0,i.x7)((0,i.H9)(this.db,"users",e.uid));a.exists()?this.currentUser={...e,...a.data()}:this.currentUser=e,"login"!==t&&""!==t||(window.location.hash="#dashboard")}catch(t){console.error("❌ Erro ao obter dados do usuário:",t),this.currentUser=e}else this.currentUser=null,"login"!==t&&(window.location.hash="#login");this.authStateChangedCallbacks.forEach((e=>{try{e(this.currentUser)}catch(e){console.error("❌ Erro em callback de authStateChanged:",e)}}))}onAuthStateChanged(e){if("function"!=typeof e)throw new Error("Callback deve ser uma função");if(this.authStateChangedCallbacks.push(e),void 0!==this.currentUser)try{e(this.currentUser)}catch(e){console.error("❌ Erro em callback de authStateChanged:",e)}return()=>{this.authStateChangedCallbacks=this.authStateChangedCallbacks.filter((t=>t!==e))}}async loginWithEmailAndPassword(e,t){if(!this.auth)throw new Error("Serviço de autenticação não inicializado");try{const a=await(0,o.x9)(this.auth,e,t);return(0,r.Ds)("Login realizado com sucesso!","success"),a.user}catch(e){console.error("❌ Erro no login:",e);let t="Erro ao fazer login. Tente novamente.";switch(e.code){case"auth/invalid-email":t="Email inválido.";break;case"auth/user-disabled":t="Usuário desativado.";break;case"auth/user-not-found":t="Usuário não encontrado.";break;case"auth/wrong-password":t="Senha incorreta.";break;case"auth/too-many-requests":t="Muitas tentativas de login. Tente novamente mais tarde."}throw(0,r.Ds)(t,"error"),e}}async registerWithEmailAndPassword(e,t,a){if(!this.auth||!this.db)throw new Error("Serviço de autenticação não inicializado");try{const n=(await this.auth.createUserWithEmailAndPassword(e,t)).user;return await n.updateProfile({displayName:a}),await this.db.collection("users").doc(n.uid).set({uid:n.uid,email:e,name:a,role:"user",createdAt:new Date}),(0,r.Ds)("Conta criada com sucesso!","success"),n}catch(e){console.error("❌ Erro no cadastro:",e);let t="Erro ao criar conta. Tente novamente.";switch(e.code){case"auth/email-already-in-use":t="Este email já está em uso.";break;case"auth/invalid-email":t="Email inválido.";break;case"auth/weak-password":t="Senha muito fraca. Use pelo menos 6 caracteres."}throw(0,r.Ds)(t,"error"),e}}async sendPasswordResetEmail(e){if(!this.auth)throw new Error("Serviço de autenticação não inicializado");try{await this.auth.sendPasswordResetEmail(e),(0,r.Ds)("Email de redefinição de senha enviado!","success")}catch(e){console.error("❌ Erro ao enviar email de redefinição:",e);let t="Erro ao enviar email de redefinição. Tente novamente.";switch(e.code){case"auth/invalid-email":t="Email inválido.";break;case"auth/user-not-found":t="Usuário não encontrado."}throw(0,r.Ds)(t,"error"),e}}async logout(){if(!this.auth)throw new Error("Serviço de autenticação não inicializado");try{await this.auth.signOut(),(0,r.Ds)("Logout realizado com sucesso!","success")}catch(e){throw console.error("❌ Erro no logout:",e),(0,r.Ds)("Erro ao fazer logout. Tente novamente.","error"),e}}async updateUserProfile(e){if(!this.auth||!this.db||!this.currentUser)throw new Error("Serviço de autenticação não inicializado ou usuário não autenticado");try{const t=this.auth.currentUser;return e.name&&await t.updateProfile({displayName:e.name}),e.email&&e.email!==t.email&&await t.updateEmail(e.email),await this.db.collection("users").doc(t.uid).update({...e,updatedAt:new Date}),this.currentUser={...this.currentUser,...e},(0,r.Ds)("Perfil atualizado com sucesso!","success"),this.currentUser}catch(e){console.error("❌ Erro ao atualizar perfil:",e);let t="Erro ao atualizar perfil. Tente novamente.";switch(e.code){case"auth/email-already-in-use":t="Este email já está em uso.";break;case"auth/invalid-email":t="Email inválido.";break;case"auth/requires-recent-login":t="Esta operação é sensível e requer autenticação recente. Faça login novamente."}throw(0,r.Ds)(t,"error"),e}}async updatePassword(e,t){if(!this.auth||!this.currentUser)throw new Error("Serviço de autenticação não inicializado ou usuário não autenticado");try{const a=this.auth.currentUser,n=firebase.auth.EmailAuthProvider.credential(a.email,e);await a.reauthenticateWithCredential(n),await a.updatePassword(t),(0,r.Ds)("Senha atualizada com sucesso!","success")}catch(e){console.error("❌ Erro ao atualizar senha:",e);let t="Erro ao atualizar senha. Tente novamente.";switch(e.code){case"auth/wrong-password":t="Senha atual incorreta.";break;case"auth/weak-password":t="Nova senha muito fraca. Use pelo menos 6 caracteres.";break;case"auth/requires-recent-login":t="Esta operação é sensível e requer autenticação recente. Faça login novamente."}throw(0,r.Ds)(t,"error"),e}}isAuthenticated(){return!!this.currentUser}getCurrentUser(){return this.currentUser}hasRole(e){return!(!this.currentUser||!this.currentUser.role)&&(Array.isArray(e)?e.includes(this.currentUser.role):this.currentUser.role===e)}static createForTenant(e,t){const a=new s(e,t);return a.init(),a}}},472:function(e,t,a){a.d(t,{ap:function(){return l},fW:function(){return d},rf:function(){return c},xL:function(){return u}});var n=a(223),r=a(927),o=a(26),i=a(539);const s={};function c(e,t="default"){return s[t]||(s[t]=(0,n.Wp)(e,t)),s[t]}function u(e){return(0,o.aU)(e)}function l(e){return(0,r.xI)(e)}function d(e){return(0,i.c7)(e)}},720:function(e,t,a){function n(e,t="info",a=3e3){if(window.notificationComponent)return void window.notificationComponent.show(e,t,a);const n=document.getElementById("notification-container")||function(){const e=document.createElement("div");if(e.id="notification-container",e.style.position="fixed",e.style.top="20px",e.style.right="20px",e.style.zIndex="9999",document.body.appendChild(e),!document.getElementById("notification-styles")){const e=document.createElement("style");e.id="notification-styles",e.textContent="\n            @keyframes fadeIn {\n                from { opacity: 0; transform: translateX(20px); }\n                to { opacity: 1; transform: translateX(0); }\n            }\n            \n            @keyframes fadeOut {\n                from { opacity: 1; transform: translateX(0); }\n                to { opacity: 0; transform: translateX(20px); }\n            }\n            \n            .notification {\n                background-color: #3B82F6;\n                color: #FFFFFF;\n                padding: 12px 16px;\n                border-radius: 8px;\n                margin-bottom: 10px;\n                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                min-width: 300px;\n                max-width: 450px;\n                animation: fadeIn 0.3s ease;\n            }\n            \n            .notification-success {\n                background-color: #10B981;\n            }\n            \n            .notification-error {\n                background-color: #EF4444;\n            }\n            \n            .notification-warning {\n                background-color: #F59E0B;\n            }\n            \n            .notification-info {\n                background-color: #3B82F6;\n            }\n            \n            .notification-content {\n                display: flex;\n                align-items: center;\n            }\n            \n            .notification-icon {\n                margin-right: 8px;\n            }\n            \n            .notification-close {\n                background: none;\n                border: none;\n                color: #FFFFFF;\n                font-size: 20px;\n                cursor: pointer;\n                margin-left: 8px;\n            }\n        ",document.head.appendChild(e)}return e}(),o=document.createElement("div");o.className=`notification notification-${t}`;let i="";switch(t){case"success":i='<i class="fas fa-check-circle"></i>';break;case"error":i='<i class="fas fa-exclamation-circle"></i>';break;case"warning":i='<i class="fas fa-exclamation-triangle"></i>';break;default:i='<i class="fas fa-info-circle"></i>'}o.innerHTML=`\n        <div class="notification-content">\n            <span class="notification-icon">${i}</span>\n            <span>${e}</span>\n        </div>\n        <button class="notification-close">&times;</button>\n    `,n.appendChild(o),o.querySelector(".notification-close").addEventListener("click",(()=>{r(o)})),a>0&&setTimeout((()=>{r(o)}),a)}function r(e){e&&e.parentNode&&(e.style.animation="fadeOut 0.3s ease",setTimeout((()=>{e.parentNode&&e.parentNode.removeChild(e)}),300))}a.d(t,{Ds:function(){return n}})}}]);